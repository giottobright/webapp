# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ git clone –≤ Dockerfile

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:

```
error: RPC failed; curl 56 GnuTLS recv error (-54): Error in the pull function.
error: 6098 bytes of body are still expected
fetch-pack: unexpected disconnect while reading sideband packet
fatal: early EOF
fatal: fetch-pack: invalid index-pack output
```

–≠—Ç–æ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏–∑ GitHub –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏—è:

### –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Dockerfile —Å retry –ª–æ–≥–∏–∫–æ–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Dockerfile.retry` - –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ 5 –ø–æ–ø—ã—Ç–æ–∫ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã git
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π postBuffer
- ‚úÖ Shallow clone (--depth 1) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

**–í Timeweb Cloud:**
1. –£–∫–∞–∂–∏—Ç–µ `Dockerfile.retry` –∫–∞–∫ Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏
2. –ò–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ `Dockerfile.retry` ‚Üí `Dockerfile`

### –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Dockerfile

`Dockerfile` –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
- 3 –ø–æ–ø—ã—Ç–∫–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è git

### –†–µ—à–µ–Ω–∏–µ 3: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è)

–ï—Å–ª–∏ git clone –≤—Å–µ –µ—â–µ –ø–∞–¥–∞–µ—Ç, –º–æ–∂–Ω–æ:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å COPY –≤–º–µ—Å—Ç–æ git clone:**
   ```dockerfile
   # –í–º–µ—Å—Ç–æ git clone, –∫–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
   COPY . /opt/build
   WORKDIR /opt/build
   ```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitHub Actions –¥–ª—è —Å–±–æ—Ä–∫–∏:**
   - –°–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –≤ GitHub Actions
   - –ü—É—à–∏—Ç—å –≤ Docker Hub
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ –≤ Timeweb

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å git submodule:**
   ```dockerfile
   # –ï—Å–ª–∏ webapp - —ç—Ç–æ submodule
   COPY .gitmodules .gitmodules
   RUN git submodule update --init --recursive
   ```

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Dockerfile.retry

1. **–í Timeweb Cloud Console:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
   - –í —Ä–∞–∑–¥–µ–ª–µ "Dockerfile" —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å: `webapp/Dockerfile.retry`
   - –ò–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ

2. **–ò–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   cd webapp
   mv Dockerfile Dockerfile.old
   mv Dockerfile.retry Dockerfile
   git add Dockerfile
   git commit -m "fix: —É–ª—É—á—à–µ–Ω Dockerfile —Å retry –ª–æ–≥–∏–∫–æ–π –¥–ª—è git clone"
   git push
   ```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Dockerfile

–ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `webapp/Dockerfile` - –æ–Ω —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è.

## üìã –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### Dockerfile.retry:
- ‚úÖ 5 –ø–æ–ø—ã—Ç–æ–∫ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–º–µ—Å—Ç–æ 1)
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 10 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç: 600 —Å–µ–∫—É–Ω–¥
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π postBuffer: 500MB
- ‚úÖ Shallow clone (--depth 1) - –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Dockerfile:
- ‚úÖ 3 –ø–æ–ø—ã—Ç–∫–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è git

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GitHub:**
   ```bash
   curl -I https://github.com/giottobright/webapp.git
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
   - –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--depth 1`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å –≤ Docker:**
   ```dockerfile
   RUN ping -c 3 github.com
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥:**
   - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤–º–µ—Å—Ç–æ git clone
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∏–∑ Docker Hub

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Dockerfile.retry** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
2. **Shallow clone** (--depth 1) –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ
3. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** –ø–æ–º–æ–≥–∞—é—Ç –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
4. **Retry –ª–æ–≥–∏–∫–∞** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏

## ‚úÖ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑ –≤ Timeweb Cloud
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Clone successful!"
3. –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø–∞–¥–∞–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (COPY)

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ


